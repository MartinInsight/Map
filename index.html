<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Congestion Map</title>
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxNvVzYwGGt4oWJc/GzXgYt0H9c3FwXG/A1fM4O5g=="
        crossorigin=""/>
    <!-- Leaflet MarkerCluster CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />
    <!-- Custom CSS -->
    <link rel="stylesheet" href="main.css">
    <!-- Font Awesome for icons (if needed) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <div class="transport-tab-container">
        <button class="transport-tab active" data-map-id="rail-map">Rail Map</button>
        <button class="transport-tab" data-map-id="air-map">Air Map</button>
        <button class="transport-tab" data-map-id="truck-map">Truck Map</button>
    </div>

    <div id="rail-map" class="transport-map active"></div>
    <div id="air-map" class="transport-map"></div>
    <div id="truck-map" class="transport-map"></div>

    <!-- Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20n5JcWnSj8/4W4Wl2uM/2+H3p4Wq5G2g/L2+M/P+A/M="
        crossorigin=""></script>
    <!-- Leaflet MarkerCluster JavaScript -->
    <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
    <!-- Custom JavaScript -->
    <script src="rail_map.js"></script>
    <script src="main.js"></script>

    <script>
        // 전역 변수로 맵 인스턴스를 저장하기 위한 객체
        const maps = {};

        document.addEventListener('DOMContentLoaded', () => {
            // 초기 Rail Map 로드
            maps['rail-map'] = new RailCongestionMap('rail-map');

            const tabButtons = document.querySelectorAll('.transport-tab');
            const mapContainers = document.querySelectorAll('.transport-map');

            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const mapId = button.dataset.mapId;

                    // 탭 버튼 활성화 상태 변경
                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');

                    // 맵 컨테이너 표시/숨기기
                    mapContainers.forEach(container => {
                        if (container.id === mapId) {
                            container.classList.add('active');
                            // 맵이 숨겨져 있다가 표시될 때 invalidateSize 호출하여 맵 크기 조정
                            if (maps[mapId] && maps[mapId].map) {
                                maps[mapId].map.invalidateSize();
                            }
                        } else {
                            container.classList.remove('active');
                        }
                    });

                    // 해당 맵이 아직 로드되지 않았다면 로드
                    if (!maps[mapId]) {
                        // TODO: 각 맵 타입에 맞는 클래스를 동적으로 로드 및 초기화
                        // 현재는 rail_map.js만 있으므로, air-map과 truck-map에 대한 로직 추가 필요
                        if (mapId === 'air-map') {
                            // maps['air-map'] = new AirCongestionMap('air-map');
                            console.log('Air Map will be initialized here.');
                        } else if (mapId === 'truck-map') {
                            // maps['truck-map'] = new TruckCongestionMap('truck-map');
                            console.log('Truck Map will be initialized here.');
                        }
                    }
                });
            });
        });
    </script>
</body>
</html>
