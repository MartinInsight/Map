<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transport Congestion Map</title>
    
    <!-- ✅ CSS 로드 (절대경로) -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css">
    <link rel="stylesheet" href="/styles/main.css">  <!-- 프로젝트 루트 기준 -->
    
    <!-- ✅ JS 로드 (모듈화) -->
    <script type="module">
        import { RailCongestionMap } from '/js/rail_map.js';
        import { AirCongestionMap } from '/js/air_map.js';
        import { TruckCongestionMap } from '/js/truck_map.js';
        import { OceanCongestionMap } from '/js/ocean_map.js';
        
        // 맵 인스턴스 관리
        const maps = {};
        
        // 초기화 함수
        function initMap(mapId) {
            switch(mapId) {
                case 'rail-map': return new RailCongestionMap(mapId);
                case 'air-map': return new AirCongestionMap(mapId);
                case 'truck-map': return new TruckCongestionMap(mapId);
                case 'ocean-map': return new OceanCongestionMap(mapId);
            }
        }
        
        // 탭 전환 로직
        document.querySelectorAll('.transport-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                const mapId = tab.dataset.mapId;
                
                // 탭/맵 활성화
                document.querySelectorAll('.transport-tab, .transport-map').forEach(el => {
                    el.classList.remove('active');
                });
                tab.classList.add('active');
                document.getElementById(mapId).classList.add('active');
                
                // 맵 초기화 (없을 경우)
                if (!maps[mapId]) {
                    maps[mapId] = initMap(mapId);
                }
                
                // 리사이즈 강제 실행
                setTimeout(() => maps[mapId].map.invalidateSize(), 100);
            });
        });
        
        // 기본 로드
        document.addEventListener('DOMContentLoaded', () => {
            maps['rail-map'] = initMap('rail-map');
        });
    </script>
</head>
<body>
    <!-- ✅ 탭 메뉴 (4개 전부 포함) -->
    <div class="transport-tab-container">
        <button class="transport-tab active" data-map-id="rail-map">Rail</button>
        <button class="transport-tab" data-map-id="air-map">Air</button>
        <button class="transport-tab" data-map-id="truck-map">Truck</button>
        <button class="transport-tab" data-map-id="ocean-map">Ocean</button>
    </div>
    
    <!-- ✅ 모든 맵 컨테이너 -->
    <div id="rail-map" class="transport-map active"></div>
    <div id="air-map" class="transport-map"></div>
    <div id="truck-map" class="transport-map"></div>
    <div id="ocean-map" class="transport-map"></div>
</body>
</html>
